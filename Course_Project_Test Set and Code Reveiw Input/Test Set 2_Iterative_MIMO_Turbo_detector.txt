Joint MIMO detection and turbo decoding:

Let's use the same rate 1/2 (7,5) turbo code as in Hw5
Assume that the input has length 8 (including 2 termination bits)
Turbo Interleaver for 8 bits
[2  1  7 5  3  6  8  4]

channel interleaver for 16 bits
[3 8 14 1 5 4 10 9 11 16 15 12 13 6 7 2]

Use a MIMO channel with two transmit and two receive antennas.
Each time we transmit two QPSK symbols. It takes 4 transmissions
for 8 QPSK symbols.

Eb/N0=2db (following the definition given in the paper)

Mc=2 #QPSK
Mt=2
Nr=2

Es=4 # in linear
#Es here is total energy(not average energy per symbol) through Tx antenna
#Es = (energy per symbol * Mt)
EbN0=2 #in dB
sigma2=(Es/2)*(Nr/(Code_R*Mt*Mc))*(10**(-EbN0/10))

EsN0=EbN0-10*np.log10(Nr/(Code_R*Mt*Mc)) #in dB
EsN0=10**(EsN0/10) #in Linear scale


H_i the channel matrix for the i-th transmission (channel use)

H[0] = [[ 1.8+1.5j  0.4-0.2j]
     [ 1. +0.3j  2.2-0.9j]]

H[1] = [[ 1.9-2.6j -1. +0.7j]
      [ 1. +0.9j -0.2-0.7j]]

H[2] = [[-0.1+2.3j  0.4-1.5j]
      [ 0.1+0.j   1.5-0.2j]]

H[3] = [[ 0.8+1.5j  0.1+1.5j]
      [ 0.4+0.2j  0.3+0.4j]]

Assume that Y_i is the received signal from the two receive antennas for the i-th channel use
Y_i=H_i*X_i+W_i:

Y1 = [-0.9-1.j  -2. -1.4j]
Y2 = [-0.3-1.7j  0.2+2.j ]
Y3 = [ 1.2-0.5j  1.2-0.4j]
Y4 = [-0.4-1.3j -0.3+0.8j]

Perform one iteration of MIMO detection followed by two (inner) iterations of turbo decoding.

=========================================================
========= Expected Outputs ==============================
=========================================================

=========================
outer iteration number:1
=========================
MIMO detector output extrinsic LLR(de-interleaved, La2):
[ 0.3888 -0.1167  0.2122 -5.7695  1.2623  1.0165 -0.6359  1.9806 -1.0224
  1.2589  2.3167 -3.0228  0.5922  1.9454  2.1534 -2.6953]

inner iteration number:1
Extrinsic LLR ul from decoder1:
[ 0.2717  0.5378 -0.0711  0.4206 -0.3291  0.179  -1.7756 -0.158 ]
Extrinsic LLR pl from decoder1:
[ 0.7772 -0.3055 -0.0577  0.0018  0.3098 -1.5226 -0.1156  1.9954]
Turbo Decoder 2 Extrinsic LLR, after channel interleaving, to be passed into the MIMO detector:
[ 1.8315  0.4014 -0.1156  1.6556  1.1416 -0.809   0.3098 -1.6584  0.7972
  0.1289 -0.3062 -0.6605 -2.5132 -0.0577  1.5855  0.7772]

inner iteration number:2
Extrinsic LLR ul from decoder1:
[ 1.2575  2.2925  1.655   1.9219 -1.812   1.4829 -3.0249  1.907 ]
Extrinsic LLR pl from decoder1:
[ 3.1469 -2.7762  1.9235  2.4051  2.1738 -3.275   1.6437  3.9122]
Turbo Decoder 2 Extrinsic LLR, after channel interleaving, to be passed into the MIMO detector:
[ 5.8793  3.2143  1.6437  5.6995  4.375  -4.2923  2.1738 -5.7422  4.521
 -1.1769  2.948  -2.6412 -5.6678  1.9235  4.2036  3.1469]

=========================
outer iteration number:2
=========================
MIMO detector output extrinsic LLR(de-interleaved, La2):
[  4.9214   0.6392   2.2837 -11.3029   3.0232   1.3642   3.6244   1.135
  -0.682    5.1274   5.2671  -4.2709  -4.5153   0.9491   4.4478  -4.4099]

inner iteration number:1
Extrinsic LLR ul from decoder1:
[ 5.3082  5.675   5.5911  4.734  -7.7885  4.084  -5.798   4.4486]
Extrinsic LLR pl from decoder1:
[ 9.5904 -7.8911  6.8846  7.6919  4.1387 -8.2949  7.7634  8.8964]
Turbo Decoder 2 Extrinsic LLR, after channel interleaving, to be passed into the MIMO detector:
[ 21.3829  14.5677   7.7634  18.7339   9.8617 -15.0876   4.1387 -17.157
  12.3992  -7.8645   8.8385  -8.6037 -11.312    6.8846   9.1318   9.5904]

inner iteration number:2
Extrinsic LLR ul from decoder1:
[ 10.0249  11.1311  18.7989  15.9998 -14.9031  13.7655 -14.0945  15.9127]
Extrinsic LLR pl from decoder1:
[ 27.7328 -27.9854  24.5894  24.0652  18.6133 -23.6705  22.7471  24.7504]
Turbo Decoder 2 Extrinsic LLR, after channel interleaving, to be passed into the MIMO detector:
[ 30.6434  22.7664  22.7471  26.6337  23.0698 -20.1911  18.6133 -24.7189
  22.4461 -18.6512  20.3225 -20.6589 -19.6394  24.5894  20.4096  27.7328]

Final soft LLR out of decoder 2, after second outer iterations and second inner iterations:
[ 31.5551  28.372   32.9271 -31.494   26.093   25.9536  24.034   23.9014
 -25.4009  23.7407  27.7132 -24.9298 -24.1547  23.6962  24.7703 -23.0611]